<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>USM Digital Coach – Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f5f7;
      --bg-alt: #ffffff;
      --text: #1f1f23;
      --muted: #6b6b75;
      --accent: #c53b3b;
      --accent-soft: #f7e3e3;
      --border: #dedee5;
      --card-radius: 10px;
      --shadow-soft: 0 4px 10px rgba(0, 0, 0, 0.04);
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(245, 245, 247, 0.96);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
    }

    .nav {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.6rem 1.25rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .brand-dot {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #ffb3b3, #c53b3b);
    }

    .nav-links {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .nav-button {
      border: none;
      background: transparent;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      font-size: 0.85rem;
      cursor: pointer;
      color: var(--muted);
      transition: background 0.15s, color 0.15s;
    }

    .nav-button.active {
      background: var(--accent);
      color: #fff;
    }

    .nav-button:not(.active):hover {
      background: rgba(0, 0, 0, 0.04);
    }

    main {
      max-width: 1100px;
      margin: 1.5rem auto 2.5rem;
      padding: 0 1.25rem;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .hero {
      background: var(--bg-alt);
      border-radius: 18px;
      box-shadow: var(--shadow-soft);
      padding: 1.75rem 1.75rem 1.5rem;
      margin-bottom: 1.5rem;
    }

    .hero-title {
      font-size: 1.6rem;
      font-weight: 650;
      margin-bottom: 0.3rem;
    }

    .hero-subtitle {
      color: var(--muted);
      font-size: 0.95rem;
      margin-bottom: 1.25rem;
    }

    .hero-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 0.55rem 1.1rem;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: background 0.15s, color 0.15s, border-color 0.15s,
        transform 0.05s;
    }

    .btn-primary {
      background: var(--accent);
      color: #fff;
    }

    .btn-primary:hover {
      background: #a93030;
      transform: translateY(-1px);
    }

    .btn-ghost {
      background: transparent;
      color: var(--accent);
      border-color: var(--accent-soft);
    }

    .btn-ghost:hover {
      background: var(--accent-soft);
    }

    .grid {
      display: grid;
      gap: 1rem;
    }

    @media (min-width: 720px) {
      .grid-3 {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      .grid-2 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    .card {
      background: var(--bg-alt);
      border-radius: var(--card-radius);
      padding: 1.1rem 1.15rem;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(0, 0, 0, 0.02);
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .card-title {
      font-size: 0.98rem;
      font-weight: 600;
    }

    .card-text {
      font-size: 0.86rem;
      color: var(--muted);
      flex: 1;
    }

    .tag {
      display: inline-block;
      padding: 0.18rem 0.5rem;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 500;
      background: rgba(0, 0, 0, 0.035);
      color: var(--muted);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 0.2rem 0.65rem;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.035);
      font-size: 0.78rem;
      cursor: pointer;
      border: 1px solid transparent;
      margin: 0.15rem;
    }

    .pill:hover {
      border-color: rgba(0, 0, 0, 0.08);
    }

    .pill.selected {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
    }

    .section-title {
      font-size: 1.15rem;
      font-weight: 600;
      margin: 0.25rem 0 0.5rem;
    }

    .section-subtitle {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 0.9rem;
    }

    .detail-panel {
      margin-top: 1rem;
      padding: 1rem 1rem 0.75rem;
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid var(--border);
    }

    .detail-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .detail-sub {
      font-size: 0.86rem;
      color: var(--muted);
      margin-bottom: 0.55rem;
    }

    .detail-h {
      font-size: 0.88rem;
      font-weight: 600;
      margin-top: 0.65rem;
      margin-bottom: 0.2rem;
    }

    .detail-list {
      padding-left: 1.1rem;
      margin: 0.1rem 0 0.2rem;
      font-size: 0.86rem;
      color: var(--muted);
    }

    .detail-list li {
      margin-bottom: 0.1rem;
    }

    .coach-layout {
      display: grid;
      grid-template-rows: auto 1fr auto;
      gap: 0.75rem;
      height: min(70vh, 600px);
      max-height: 600px;
    }

    .coach-quick {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .coach-quick button {
      font-size: 0.8rem;
      padding: 0.25rem 0.7rem;
    }

    .coach-chat {
      border-radius: 12px;
      background: var(--bg-alt);
      border: 1px solid var(--border);
      padding: 0.75rem;
      overflow-y: auto;
    }

    .msg {
      margin-bottom: 0.5rem;
      max-width: 80%;
      padding: 0.45rem 0.6rem;
      border-radius: 12px;
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .msg.user {
      margin-left: auto;
      background: var(--accent);
      color: #fff;
      border-bottom-right-radius: 3px;
    }

    .msg.coach {
      margin-right: auto;
      background: #ffffff;
      border: 1px solid var(--border);
      border-bottom-left-radius: 3px;
    }

    .coach-input-row {
      display: flex;
      gap: 0.5rem;
    }

    .coach-input-row input {
      flex: 1;
      padding: 0.55rem 0.7rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 0.85rem;
    }

    .coach-input-row input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .wizard-steps {
      display: flex;
      gap: 0.5rem;
      font-size: 0.8rem;
      margin-bottom: 0.75rem;
      flex-wrap: wrap;
    }

    .wizard-step-pill {
      padding: 0.25rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      background: rgba(255, 255, 255, 0.8);
    }

    .wizard-step-pill.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    .checkbox-list {
      display: grid;
      gap: 0.3rem;
      margin-bottom: 0.7rem;
    }

    .checkbox-item {
      display: flex;
      align-items: flex-start;
      gap: 0.45rem;
      font-size: 0.86rem;
    }

    .checkbox-item input {
      margin-top: 0.18rem;
    }

    textarea {
      width: 100%;
      min-height: 80px;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 0.45rem 0.6rem;
      font-size: 0.85rem;
      resize: vertical;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    .wizard-nav {
      margin-top: 0.9rem;
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }

    .muted {
      color: var(--muted);
      font-size: 0.82rem;
    }

    .result-chip {
      display: inline-flex;
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      font-size: 0.8rem;
      background: rgba(0, 0, 0, 0.035);
      margin: 0.15rem 0.25rem 0.15rem 0;
    }
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand">
        <div class="brand-dot"></div>
        <span>USM Digital Coach</span>
      </div>
      <div class="nav-links">
        <button class="nav-button active" data-target="home">Home</button>
        <button class="nav-button" data-target="explore">Explore USM</button>
        <button class="nav-button" data-target="coach">Ask the Coach</button>
        <button class="nav-button" data-target="issues">Solve Issues</button>
      </div>
    </div>
  </header>

  <main>
    <section id="home" class="section active">
      <div class="hero">
        <div class="hero-title">Unified Service Management (USM)</div>
        <div class="hero-subtitle">
          A universal operating model for any service organization — IT, HR,
          Facilities, Healthcare, Government, and more.
        </div>
        <div class="hero-actions">
          <button class="btn btn-primary" data-target="explore">
            Learn USM Basics
          </button>
          <button class="btn btn-ghost" data-target="coach">
            Ask the USM Coach
          </button>
        </div>
      </div>

      <div class="grid grid-3">
        <div class="card">
          <div class="card-title">Learn the model</div>
          <div class="card-text">
            Explore the USM foundation, its 5 universal processes, and 8
            standard workflows in one place.
          </div>
          <button class="btn btn-ghost" data-target="explore">
            Open USM Explorer
          </button>
        </div>
        <div class="card">
          <div class="card-title">Talk to the coach</div>
          <div class="card-text">
            Ask questions and get clear, business-focused explanations about
            USM and how it applies to your organization.
          </div>
          <button class="btn btn-ghost" data-target="coach">
            Start a conversation
          </button>
        </div>
        <div class="card">
          <div class="card-title">Solve business issues</div>
          <div class="card-text">
            Describe your challenges — such as lack of control or siloed teams —
            and see which USM elements can help.
          </div>
          <button class="btn btn-ghost" data-target="issues">
            Start issue mapping
          </button>
        </div>
      </div>
    </section>

    <section id="explore" class="section">
      <div class="section-title">Explore Unified Service Management</div>
      <div class="section-subtitle">
        Browse the USM foundation, 5 processes, and 8 workflows.
      </div>

      <h3 class="section-title">USM Foundation</h3>
      <div class="grid grid-3" id="foundation-grid"></div>

      <h3 class="section-title" style="margin-top:1.2rem;">The 5 USM Processes</h3>
      <div class="grid grid-3" id="process-grid"></div>

      <h3 class="section-title" style="margin-top:1.2rem;">The 8 Workflows</h3>
      <div class="grid grid-2" id="workflow-grid"></div>

      <div id="explore-detail" class="detail-panel" style="display:none;"></div>
    </section>

    <section id="coach" class="section">
      <div class="section-title">Ask the USM Coach</div>
      <div class="section-subtitle">
        Get clear answers about USM, its processes and workflows, in business
        language.
      </div>

      <div class="coach-layout">
        <div class="coach-quick">
          <button class="btn btn-ghost coach-suggest">
            Explain USM in simple terms
          </button>
          <button class="btn btn-ghost coach-suggest">
            How does USM improve control?
          </button>
          <button class="btn btn-ghost coach-suggest">
            What are the 5 USM processes?
          </button>
        </div>

        <div id="coach-chat" class="coach-chat">
          <div class="msg coach">
            Hi, I’m your USM Digital Coach. Ask me about the USM model, its
            processes, workflows, or how it helps with issues like control,
            unification, or service quality.
          </div>
        </div>

        <div class="coach-input-row">
          <input
            type="text"
            id="coach-input"
            placeholder="Type your question about USM..."
          />
          <button class="btn btn-primary" id="coach-send">Ask</button>
        </div>
      </div>
      <p class="muted" style="margin-top:0.4rem;">
        This prototype uses simple, rule-based answers based on your USM
        content. Later, you can connect it to an AI backend.
      </p>
    </section>

    <section id="issues" class="section">
      <div class="section-title">Map your challenges to USM</div>
      <div class="section-subtitle">
        Describe your situation and see which USM processes and workflows are
        most relevant.
      </div>

      <div class="wizard-steps">
        <div class="wizard-step-pill active" data-step="1">Step 1: Challenges</div>
        <div class="wizard-step-pill" data-step="2">Step 2: Context</div>
        <div class="wizard-step-pill" data-step="3">Step 3: USM Guidance</div>
      </div>

      <div id="wizard-step-1">
        <p style="font-size:0.9rem;">
          What challenges are you experiencing? (You can select more than one.)
        </p>
        <div class="checkbox-list" id="challenge-list"></div>

        <p class="detail-h" style="margin-top:0.7rem;">Optional: describe your situation</p>
        <textarea id="issue-description" placeholder="Example: We use several different tools, leadership has no unified view, and each department works in its own way."></textarea>

        <div class="wizard-nav">
          <button class="btn btn-primary" id="wizard-next-1">Next</button>
        </div>
      </div>

      <div id="wizard-step-2" style="display:none;">
        <p style="font-size:0.9rem;">Where do these challenges mainly occur?</p>
        <div id="domain-pills"></div>

        <div class="wizard-nav">
          <button class="btn btn-ghost" id="wizard-back-2">Back</button>
          <button class="btn btn-primary" id="wizard-next-2">
            See my USM guidance
          </button>
        </div>
      </div>

      <div id="wizard-step-3" style="display:none;">
        <div id="wizard-results" class="detail-panel"></div>
        <div class="wizard-nav">
          <button class="btn btn-ghost" id="wizard-back-3">Back</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    const foundationConcepts = [
      {
        id: "FOUNDATION_WHAT",
        title: "What is USM?",
        summary:
          "USM is a unified management system for any service organization, replacing scattered frameworks with one operating model.",
        type: "foundation",
        detail: {
          summary:
            "USM (Unified Service Management) provides a single way to design, deliver, and improve services across your organization.",
          whyItMatters: [
            "Reduces complexity by providing one model instead of many frameworks.",
            "Supports cross-department collaboration and shared language.",
            "Helps leadership steer services based on a clear, consistent structure."
          ]
        }
      },
      {
        id: "FOUNDATION_WHY",
        title: "Why Unified?",
        summary:
          "Different departments often use different models. USM unifies them into one way of working.",
        type: "foundation",
        detail: {
          summary:
            "A unified model avoids duplicated structures and conflicting practices between IT, HR, Facilities, and other domains.",
          whyItMatters: [
            "Eliminates fragmentation in how services are managed.",
            "Makes it easier to implement governance and improvement organization-wide.",
            "Supports better control, quality, and customer experience."
          ]
        }
      },
      {
        id: "FOUNDATION_PRINCIPLES",
        title: "USM Principles",
        summary:
          "Simplify, standardize, and unify how services are managed, regardless of the domain.",
        type: "foundation",
        detail: {
          summary:
            "USM is built on a small set of principles that keep the model simple and reusable.",
          whyItMatters: [
            "Prevents over-engineering of processes.",
            "Focuses on reusable patterns instead of one-off solutions.",
            "Supports scaling from one department to the whole enterprise."
          ]
        }
      }
    ];

    const processes = [
      {
        id: "PROC_USE",
        name: "Use Process",
        oneLine:
          "Manages how customers and users consume services in a consistent way.",
        purpose:
          "The Use process focuses on how services are requested, accessed, and experienced by customers and users.",
        keyResponsibilities: [
          "Ensure users know how to request and use services.",
          "Capture demand and usage in a consistent way.",
          "Provide a clear interface between users and service teams."
        ],
        supportsControl: [
          "Makes service consumption visible and measurable.",
          "Creates a standard experience for users across services."
        ]
      },
      {
        id: "PROC_CHANGE",
        name: "Change Process",
        oneLine:
          "Provides a controlled way to improve and adapt services without chaos.",
        purpose:
          "The Change process manages improvements, adaptations, and other modifications to services and service systems.",
        keyResponsibilities: [
          "Evaluate and prioritize change proposals.",
          "Reduce risk associated with changes.",
          "Align change decisions with organizational goals."
        ],
        supportsControl: [
          "Avoids uncontrolled changes that undermine stability.",
          "Links improvement actions to clear decisions."
        ]
      },
      {
        id: "PROC_RECOVER",
        name: "Recover Process",
        oneLine:
          "Restores service after disruptions and protects continuity.",
        purpose:
          "The Recover process ensures that disruptions are handled in a structured way and that services can be restored quickly.",
        keyResponsibilities: [
          "Coordinate restoration efforts after disruptions.",
          "Balance speed of recovery with risk and quality.",
          "Provide input to structural improvements."
        ],
        supportsControl: [
          "Reduces downtime and uncertainty during disruptions.",
          "Connects incident handling with long-term stability."
        ]
      },
      {
        id: "PROC_CONTROL",
        name: "Control Process",
        oneLine:
          "Provides governance and oversight over all services based on facts.",
        purpose:
          "The Control process consolidates information about service performance, risk, and cost so leaders can steer effectively.",
        keyResponsibilities: [
          "Define and maintain performance and risk indicators.",
          "Provide regular, comparable reporting across services.",
          "Support decisions on priorities and investments."
        ],
        supportsControl: [
          "Creates a single governance model for all services.",
          "Aligns teams around shared performance data."
        ]
      },
      {
        id: "PROC_PREVENT",
        name: "Prevent Process",
        oneLine:
          "Avoids future disruptions and structural issues by learning from experience.",
        purpose:
          "The Prevent process focuses on learning from incidents, trends, and risks to reduce future harm.",
        keyResponsibilities: [
          "Analyze patterns in incidents and problems.",
          "Identify structural weaknesses in services.",
          "Initiate preventive improvements."
        ],
        supportsControl: [
          "Shifts from reactive firefighting to proactive risk reduction.",
          "Protects continuity and service quality over time."
        ]
      }
    ];

    const workflows = [
      {
        id: "WF_REQUEST",
        name: "Request Workflow",
        summary: "Handles standard requests for services or information.",
        relatedProcesses: ["PROC_USE"]
      },
      {
        id: "WF_INCIDENT",
        name: "Incident Workflow",
        summary: "Restores normal service quickly after a disruption.",
        relatedProcesses: ["PROC_RECOVER", "PROC_USE", "PROC_CONTROL"]
      },
      {
        id: "WF_CHANGE",
        name: "Change Workflow",
        summary: "Implements approved changes in a controlled manner.",
        relatedProcesses: ["PROC_CHANGE", "PROC_CONTROL"]
      },
      {
        id: "WF_PROBLEM",
        name: "Problem Workflow",
        summary:
          "Investigates root causes of recurring incidents and structural issues.",
        relatedProcesses: ["PROC_PREVENT", "PROC_CHANGE"]
      },
      {
        id: "WF_KNOWLEDGE",
        name: "Knowledge Workflow",
        summary:
          "Captures and shares reusable knowledge for users and staff.",
        relatedProcesses: ["PROC_USE", "PROC_PREVENT"]
      },
      {
        id: "WF_CONFIG",
        name: "Configuration / Asset Workflow",
        summary:
          "Keeps information about services and supporting components reliable.",
        relatedProcesses: ["PROC_CONTROL", "PROC_RECOVER", "PROC_CHANGE"]
      },
      {
        id: "WF_IDENTITY",
        name: "Identity & Access Workflow",
        summary:
          "Manages who has access to which services in a controlled way.",
        relatedProcesses: ["PROC_USE", "PROC_CONTROL"]
      },
      {
        id: "WF_CONTINUITY",
        name: "Continuity / Availability Workflow",
        summary:
          "Protects the ability of services to continue during disruptions.",
        relatedProcesses: ["PROC_RECOVER", "PROC_PREVENT", "PROC_CONTROL"]
      }
    ];

    const issuePatterns = [
      {
        id: "ISSUE_LACK_CONTROL",
        name: "Lack of control",
        challenges: ["lack_of_control", "operational_chaos", "compliance_risk"],
        processes: ["PROC_CONTROL", "PROC_USE", "PROC_CHANGE"],
        workflows: ["WF_CONFIG", "WF_CONTINUITY"],
        summary:
          "Your situation points to a lack of unified governance and visibility over services.",
        actions: [
          "Define and publish a service catalog as a single reference.",
          "Standardize a small set of shared KPIs across services.",
          "Introduce regular Control reviews using comparable reports.",
          "Align existing tools to feed the same service-level view."
        ]
      },
      {
        id: "ISSUE_TOOL_FRAG",
        name: "Too many tools / fragmentation",
        challenges: ["too_many_tools", "siloed_departments"],
        processes: ["PROC_CONTROL", "PROC_USE"],
        workflows: ["WF_CONFIG", "WF_CHANGE"],
        summary:
          "Multiple tools and siloed practices make it hard to manage services consistently.",
        actions: [
          "Use USM as the common model behind all tools.",
          "Rationalize or integrate tools around shared workflows.",
          "Ensure each tool supports the same USM processes."
        ]
      },
      {
        id: "ISSUE_SLOW_RECOVERY",
        name: "Slow response and recovery",
        challenges: ["slow_recovery", "operational_chaos"],
        processes: ["PROC_RECOVER", "PROC_PREVENT"],
        workflows: ["WF_INCIDENT", "WF_PROBLEM", "WF_CONTINUITY"],
        summary:
          "Slow or chaotic recovery suggests weak incident handling and limited learning from past issues.",
        actions: [
          "Standardize the Incident workflow across teams.",
          "Capture and review major incidents and their causes.",
          "Turn repeated issues into structural improvements."
        ]
      }
    ];

    const challengeOptions = [
      { id: "lack_of_control", label: "Lack of control" },
      { id: "too_many_tools", label: "Too many tools / fragmentation" },
      { id: "siloed_departments", label: "Siloed departments" },
      {
        id: "inconsistent_experience",
        label: "Inconsistent service experience"
      },
      { id: "slow_recovery", label: "Slow response and recovery" },
      { id: "compliance_risk", label: "Compliance & audit risk" },
      {
        id: "lack_standardization",
        label: "Lack of standardization in ways of working"
      },
      { id: "operational_chaos", label: "Operational chaos" },
      { id: "high_cost", label: "High support cost" },
      {
        id: "low_employee_satisfaction",
        label: "Low employee satisfaction with services"
      }
    ];

    const domainOptions = [
      "IT",
      "HR",
      "Facilities",
      "Finance",
      "Healthcare",
      "Government",
      "Enterprise-wide"
    ];

    const sections = document.querySelectorAll(".section");
    const navButtons = document.querySelectorAll(".nav-button");
    const heroButtons = document.querySelectorAll(".hero [data-target]");

    function showSection(id) {
      sections.forEach((s) => {
        s.classList.toggle("active", s.id === id);
      });
      navButtons.forEach((btn) => {
        btn.classList.toggle("active", btn.dataset.target === id);
      });
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    navButtons.forEach((btn) => {
      btn.addEventListener("click", () => showSection(btn.dataset.target));
    });
    heroButtons.forEach((btn) => {
      btn.addEventListener("click", () => showSection(btn.dataset.target));
    });

    const foundationGrid = document.getElementById("foundation-grid");
    const processGrid = document.getElementById("process-grid");
    const workflowGrid = document.getElementById("workflow-grid");
    const exploreDetail = document.getElementById("explore-detail");

    function renderExplore() {
      foundationGrid.innerHTML = "";
      foundationConcepts.forEach((f) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <div class="card-title">${f.title}</div>
          <div class="card-text">${f.summary}</div>
          <button class="btn btn-ghost" data-explore-id="${f.id}">
            Learn more
          </button>
        `;
        foundationGrid.appendChild(div);
      });

      processGrid.innerHTML = "";
      processes.forEach((p) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <div class="tag">Process</div>
          <div class="card-title">${p.name}</div>
          <div class="card-text">${p.oneLine}</div>
          <button class="btn btn-ghost" data-explore-id="${p.id}">
            View details
          </button>
        `;
        processGrid.appendChild(div);
      });

      workflowGrid.innerHTML = "";
      workflows.forEach((w) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <div class="tag">Workflow</div>
          <div class="card-title">${w.name}</div>
          <div class="card-text">${w.summary}</div>
          <button class="btn btn-ghost" data-explore-id="${w.id}">
            View details
          </button>
        `;
        workflowGrid.appendChild(div);
      });

      document
        .getElementById("explore")
        .addEventListener("click", (event) => {
          const id = event.target.dataset.exploreId;
          if (!id) return;
          showConceptDetail(id);
        });
    }

    function showConceptDetail(id) {
      let concept = foundationConcepts.find((f) => f.id === id);
      let typeLabel = "Concept";

      if (!concept) {
        const p = processes.find((p) => p.id === id);
        if (p) {
          concept = p;
          typeLabel = "Process";
        }
      }

      if (!concept) {
        const w = workflows.find((w) => w.id === id);
        if (w) {
          concept = w;
          typeLabel = "Workflow";
        }
      }

      if (!concept) return;

      let html = `<div class="detail-title">${concept.name || concept.title}</div>`;
      html += `<div class="detail-sub">Type: ${typeLabel}</div>`;

      if (concept.detail) {
        html += `<div class="detail-h">Summary</div>`;
        html += `<p class="muted">${concept.detail.summary}</p>`;
        if (concept.detail.whyItMatters) {
          html += `<div class="detail-h">Why it matters</div><ul class="detail-list">`;
          concept.detail.whyItMatters.forEach((item) => {
            html += `<li>${item}</li>`;
          });
          html += `</ul>`;
        }
      } else if (concept.purpose) {
        html += `<div class="detail-h">Purpose</div><p class="muted">${concept.purpose}</p>`;
        if (concept.keyResponsibilities) {
          html += `<div class="detail-h">Key responsibilities</div><ul class="detail-list">`;
          concept.keyResponsibilities.forEach((item) => {
            html += `<li>${item}</li>`;
          });
          html += `</ul>`;
        }
        if (concept.supportsControl) {
          html += `<div class="detail-h">How this supports control & unification</div><ul class="detail-list">`;
          concept.supportsControl.forEach((item) => {
            html += `<li>${item}</li>`;
          });
          html += `</ul>`;
        }
      } else if (concept.summary) {
        html += `<div class="detail-h">Summary</div><p class="muted">${concept.summary}</p>`;
      }

      if (concept.relatedProcesses || concept.relatedProcesses === 0) {
        const relNames = (concept.relatedProcesses || [])
          .map((pid) => processes.find((p) => p.id === pid)?.name)
          .filter(Boolean);
        if (relNames.length) {
          html += `<div class="detail-h">Related processes</div><p class="muted">${relNames.join(
            ", "
          )}</p>`;
        }
      }

      exploreDetail.innerHTML = html;
      exploreDetail.style.display = "block";
    }

    renderExplore();

    const coachChat = document.getElementById("coach-chat");
    const coachInput = document.getElementById("coach-input");
    const coachSend = document.getElementById("coach-send");
    const coachSuggests = document.querySelectorAll(".coach-suggest");

    function addMessage(text, from = "coach") {
      const div = document.createElement("div");
      div.className = "msg " + from;
      div.textContent = text;
      coachChat.appendChild(div);
      coachChat.scrollTop = coachChat.scrollHeight;
    }

    function answerQuestion(raw) {
      const q = raw.toLowerCase();

      if (q.includes("what is usm") || q.includes("explain usm")) {
        addMessage(
          "Unified Service Management (USM) is a universal operating model for any service organization. Instead of each department inventing its own way of working, USM provides one set of processes and workflows that IT, HR, Facilities, Healthcare, and others can all use. That makes it easier to control services, unify practices, and improve the customer experience."
        );
        return;
      }

      if (q.includes("5") && q.includes("process")) {
        const names = processes.map((p) => p.name).join(", ");
        addMessage(
          "USM uses five universal processes that apply to any service domain: " +
            names +
            ". Each one plays a specific role in how services are designed, delivered, governed, and improved."
        );
        return;
      }

      if (q.includes("control")) {
        addMessage(
          "In USM, the Control process is where you regain governance and oversight. It consolidates information about service performance, risk, and cost so leaders can steer based on facts instead of anecdotes. This process is key when you feel you lack control or have fragmented reporting."
        );
        return;
      }

      if (q.includes("workflow") || q.includes("incident")) {
        addMessage(
          "USM defines a small set of standard workflows, such as the Incident workflow. The Incident workflow provides a consistent way to handle service disruptions: log, assess, assign, restore, and learn. Using common workflows across departments reduces chaos and speeds up recovery."
        );
        return;
      }

      addMessage(
        "Good question. From a USM perspective, most situations can be understood using the 5 processes and 8 workflows. As a starting point, think about which of these is most affected: " +
          processes.map((p) => p.name).join(", ") +
          "."
      );
    }

    coachSend.addEventListener("click", () => {
      const text = coachInput.value.trim();
      if (!text) return;
      addMessage(text, "user");
      coachInput.value = "";
      setTimeout(() => answerQuestion(text), 200);
    });

    coachInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        coachSend.click();
      }
    });

    coachSuggests.forEach((btn) => {
      btn.addEventListener("click", () => {
        const text = btn.textContent.trim();
        addMessage(text, "user");
        answerQuestion(text);
      });
    });

    const challengeListDiv = document.getElementById("challenge-list");
    const domainPillsDiv = document.getElementById("domain-pills");
    const wizardNext1 = document.getElementById("wizard-next-1");
    const wizardNext2 = document.getElementById("wizard-next-2");
    const wizardBack2 = document.getElementById("wizard-back-2");
    const wizardBack3 = document.getElementById("wizard-back-3");
    const step1 = document.getElementById("wizard-step-1");
    const step2 = document.getElementById("wizard-step-2");
    const step3 = document.getElementById("wizard-step-3");
    const stepPills = document.querySelectorAll(".wizard-step-pill");
    const wizardResults = document.getElementById("wizard-results");
    const issueDescription = document.getElementById("issue-description");

    let selectedChallenges = new Set();
    let selectedDomains = new Set();

    function setWizardStep(step) {
      stepPills.forEach((p) => {
        p.classList.toggle(
          "active",
          parseInt(p.dataset.step, 10) === step
        );
      });
      step1.style.display = step === 1 ? "block" : "none";
      step2.style.display = step === 2 ? "block" : "none";
      step3.style.display = step === 3 ? "block" : "none";
    }

    function renderChallenges() {
      challengeListDiv.innerHTML = "";
      challengeOptions.forEach((c) => {
        const row = document.createElement("label");
        row.className = "checkbox-item";
        row.innerHTML = `
          <input type="checkbox" value="${c.id}" />
          <span>${c.label}</span>
        `;
        const input = row.querySelector("input");
        input.addEventListener("change", () => {
          if (input.checked) selectedChallenges.add(c.id);
          else selectedChallenges.delete(c.id);
        });
        challengeListDiv.appendChild(row);
      });
    }

    function renderDomains() {
      domainPillsDiv.innerHTML = "";
      domainOptions.forEach((d) => {
        const pill = document.createElement("span");
        pill.className = "pill";
        pill.textContent = d;
        pill.addEventListener("click", () => {
          if (selectedDomains.has(d)) {
            selectedDomains.delete(d);
            pill.classList.remove("selected");
          } else {
            selectedDomains.add(d);
            pill.classList.add("selected");
          }
        });
        domainPillsDiv.appendChild(pill);
      });
    }

    renderChallenges();
    renderDomains();

    wizardNext1.addEventListener("click", () => {
      setWizardStep(2);
    });

    wizardBack2.addEventListener("click", () => {
      setWizardStep(1);
    });

    wizardBack3.addEventListener("click", () => {
      setWizardStep(2);
    });

    wizardNext2.addEventListener("click", () => {
      generateGuidance();
      setWizardStep(3);
    });

    function generateGuidance() {
      const challengesArr = Array.from(selectedChallenges);
      const domainsArr = Array.from(selectedDomains);
      const desc = issueDescription.value.trim();

      const matchedIssues = issuePatterns.filter((p) =>
        p.challenges.some((ch) => challengesArr.includes(ch))
      );

      let html = "";

      if (!challengesArr.length && !desc) {
        html += `<div class="detail-title">We need a bit more input</div>`;
        html += `<p class="muted">You didn’t select any challenges or description. Go back and add at least one challenge or a short description so we can map your situation to USM.</p>`;
        wizardResults.innerHTML = html;
        return;
      }

      html += `<div class="detail-title">Your USM-based guidance</div>`;

      if (matchedIssues.length) {
        html += `<p class="detail-sub">Based on your challenges, the following patterns are most relevant:</p>`;
        matchedIssues.forEach((m) => {
          html += `<span class="result-chip">${m.name}</span>`;
        });

        const processIds = new Set();
        const workflowIds = new Set();
        matchedIssues.forEach((m) => {
          m.processes.forEach((pid) => processIds.add(pid));
          m.workflows.forEach((wid) => workflowIds.add(wid));
        });

        const procNames = Array.from(processIds)
          .map((id) => processes.find((p) => p.id === id)?.name)
          .filter(Boolean);
        const wfNames = Array.from(workflowIds)
          .map((id) => workflows.find((w) => w.id === id)?.name)
          .filter(Boolean);

        if (procNames.length) {
          html += `<div class="detail-h">USM processes to focus on</div>`;
          html += `<p class="muted">${procNames.join(", ")}</p>`;
        }

        if (wfNames.length) {
          html += `<div class="detail-h">Key workflows</div>`;
          html += `<p class="muted">${wfNames.join(", ")}</p>`;
        }

        html += `<div class="detail-h">Executive summary</div>`;
        html += `<p class="muted">${matchedIssues[0].summary}</p>`;

        html += `<div class="detail-h">Recommended first actions</div><ul class="detail-list">`;
        matchedIssues[0].actions.forEach((a) => {
          html += `<li>${a}</li>`;
        });
        html += `</ul>`;
      } else {
        html += `<p class="muted">Your situation doesn’t match one of the predefined patterns yet, but it still fits within the USM model. Often, challenges relate to the Control, Use, or Change processes, and one or more of the 8 workflows.</p>`;
      }

      if (domainsArr.length) {
        html += `<div class="detail-h">Context</div>`;
        html += `<p class="muted">You indicated these areas: ${domainsArr.join(
          ", "
        )}.</p>`;
      }

      if (desc) {
        html += `<div class="detail-h">Your description</div>`;
        html += `<p class="muted">${desc}</p>`;
      }

      html += `<p class="muted" style="margin-top:0.7rem;">Next step: discuss this guidance with the USM Coach and translate it into concrete actions for your organization.</p>`;

      wizardResults.innerHTML = html;
    }
  </script>
</body>
</html>
